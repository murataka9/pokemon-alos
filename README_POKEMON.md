# ポケモンALOsシミュレーション

論文「Towards Digital Nature: Bridging the Gap between Turing Machine Objects and Linguistic Objects in LLMMs for Universal Interaction of Object-Oriented Descriptions」(Yoichi Ochiai et al., 2023)に基づいたポケモンシミュレーションシステムです。

## 概要

このプロジェクトは、ALOs (Abstract Language Objects) システムを使用して、ポケモンの世界をシミュレートします。3匹のポケモン（サトシのピカチュウ、ロケット団のニャース、リコのニャオハ）がコンテクストに従って戦ったり、友達になったり、技を覚えたりします。

### 主な機能

- ✨ **ALOsシステム**: 論文のPrompt 1に基づいた実装
- 🤖 **OpenAI GPT-4統合**: gpt-4-turbo-2024-04-09モデルを使用
- 📚 **RAGシステム**: ChromaDBを使ったコンテクスト管理（有効/無効切り替え可能）
- 🎮 **リアルタイムシミュレーション**: ポケモン同士のインタラクション
- 📊 **Matplotlibビジュアライゼーション**: 2種類の表示モード
  - Standard: 詳細な2Dマップ + ステータス + ログ
  - Simple: ライフゲーム風のグリッドビュー + ログ
- 📝 **イベントログ**: 全ての行動と会話を記録

## インストール

### 必要要件

- Python 3.8以上
- OpenAI APIキー（オプション: --no-openaiフラグで無効化可能）

### セットアップ

1. リポジトリのクローン/ダウンロード

```bash
cd pokemon-alos
```

2. 依存パッケージのインストール

```bash
pip install -r requirements.txt
```

3. 環境変数の設定

`.env`ファイルを作成し、OpenAI APIキーを設定します：

```bash
OPENAI_API_KEY=your_api_key_here
```

**注意**: APIキーがない場合でも、`--no-openai`フラグを使ってローカルシミュレーションのみで動作します。

## 使い方

### 基本的な実行

```bash
python main.py
```

### オプション

```bash
python main.py [オプション]
```

#### 利用可能なオプション

- `--no-rag`: RAGシステムを使用せず、全コンテクストを直接使用
- `--visualizer [standard|simple]`: ビジュアライザーのタイプを選択（デフォルト: standard）
- `--interval [ミリ秒]`: 更新間隔を設定（デフォルト: 500）
- `--no-openai`: OpenAI APIを使わず、ローカルシミュレーションのみで動作

#### 使用例

```bash
# RAGなし、簡素なビジュアライザー
python main.py --no-rag --visualizer simple

# OpenAI APIなしで実行（完全ローカル）
python main.py --no-openai

# 更新間隔を変更（高速化）
python main.py --interval 200

# 全てのオプションを組み合わせ
python main.py --no-rag --visualizer simple --interval 300 --no-openai
```

## システム構成

### ファイル構成

```
pokemon-alos/
├── main.py                   # メインプログラム
├── alos_system.py            # ALOsシステムコア
├── rag_system.py             # RAGシステム
├── pokemon_alos.py           # ポケモンALOsクラス
├── simulation_engine.py      # シミュレーションエンジン
├── visualization.py          # ビジュアライゼーション
├── pokemon_context.json      # ポケモンのコンテクストデータ
├── requirements.txt          # 依存パッケージ
├── README_POKEMON.md         # このファイル
└── .env                      # 環境変数（ユーザーが作成）
```

### アーキテクチャ

1. **RAGシステム** (`rag_system.py`)
   - ChromaDBを使用したベクトルデータベース
   - ポケモンの情報、関係性、ルール、シナリオを管理
   - クエリに応じて関連コンテクストを取得

2. **ALOsシステム** (`alos_system.py`)
   - 論文のPrompt 1に基づいたシステムプロンプト
   - OpenAI GPT-4を使用してALOsを生成
   - ポケモン同士のインタラクションをシミュレート
   - 状態の更新と行動の生成

3. **ポケモンALOs** (`pokemon_alos.py`)
   - 各ポケモンの状態管理（HP、エネルギー、気分、位置）
   - 移動、戦闘、学習のロジック
   - 関係性の追跡

4. **シミュレーションエンジン** (`simulation_engine.py`)
   - ポケモン間のインタラクション処理
   - バトル、友情、学習イベントの管理
   - イベントログの記録

5. **ビジュアライゼーション** (`visualization.py`)
   - Matplotlibを使ったリアルタイム表示
   - 2種類のビジュアライザー（Standard/Simple）
   - 状態とログの同時表示

## ポケモンの紹介

### ピカチュウ（サトシ）
- **タイプ**: でんき
- **性格**: 勇敢で忠実、仲間思い
- **技**: でんきショック、10まんボルト、かみなり、でんこうせっか、アイアンテール
- **特徴**: チームのリーダー的存在、正義感が強い

### ニャース（ロケット団）
- **タイプ**: ノーマル
- **性格**: 狡賢く、お金が大好き。人間の言葉を話せる
- **技**: ひっかく、ネコにこばん、かみつく、みだれひっかき
- **特徴**: ピカチュウを捕まえることが目標

### ニャオハ（リコ）
- **タイプ**: くさ
- **性格**: 好奇心旺盛で、マイペース
- **技**: リーフストーム、ひっかく、このは、タネマシンガン、マジカルリーフ
- **特徴**: まだ若く、これから成長していく

## シミュレーションの仕組み

### インタラクションタイプ

1. **バトル** ⚔️
   - ポケモン同士が近づき、関係性が悪い場合に発生
   - お互いにダメージを受ける
   - 関係性が悪化

2. **友情** 💚
   - ポケモン同士が近づき、友好的な場合に発生
   - 気分が良くなり、少し回復
   - 関係性が改善

3. **学習** ✨
   - ランダムに新しい技を覚える
   - 気分が「excited」になる

4. **休憩**
   - エネルギーやHPが低い時に自動的に休憩
   - HPとエネルギーが回復

5. **アイテム** 🍓
   - フィールドにきのみが出現
   - ポケモンが近づくと自動的に拾う
   - インベントリに保存（最大3個）
   - HPやEnergyが低い時に自動使用

6. **ランダムイベント** 🎲
   - コンテクストデータのシナリオから選択
   - ポケモンを近づけてイベントを発生させる

### 状態管理

各ポケモンは以下の状態を持ちます：

- **HP**: 0-100（戦闘でダメージを受ける。減少すると色が暗くなる）
- **Energy**: 0-100（行動で消費、休憩で回復）
- **気分**: normal, happy, angry, tired, excited（内部状態として管理）
- **位置**: 2D空間上の座標（0-10の範囲）
- **関係性**: 他のポケモンとの友好度（-100 to +100）
- **インベントリ**: アイテムを最大3個まで持てる

### 表示色

各ポケモンは固定色で表示されます：

- **🟡 ピカチュウ**: 黄色（RGB: 1.0, 0.9, 0.0）
- **⚪ ニャース**: 灰色（RGB: 0.7, 0.7, 0.7）
- **🟢 ニャオハ**: 緑（RGB: 0.2, 0.8, 0.3）

HPが低下すると明度が下がり、色が暗くなります（最低30%の明度を保持）

## アイテムシステム

### きのみの種類

フィールドにランダムに出現するきのみ：

| きのみ | 効果 | 絵文字 |
|--------|------|--------|
| **オレンのみ** | HP +20 | 🍎 |
| **オボンのみ** | HP +40 | 🍎 |
| **ヒメリのみ** | HP +15 | 🍎 |
| **チーゴのみ** | Energy +30 | 🍇 |
| **キーのみ** | Energy +50 | 🍇 |
| **モモンのみ** | 気分改善 | 🍌 |
| **ナナのみ** | HP・Energy +15ずつ | 🍊 |

### アイテムの仕組み

1. **出現**: ステップごとに一定確率でフィールドに出現（最大5個まで）
2. **拾う**: ポケモンが近づくと自動的に拾う
3. **所持**: 最大3個まで持てる（いっぱいの場合は自動使用）
4. **使用**: HPやEnergyが低い時に自動的に使用

### マップ上の表示

- **四角形** + **金色の枠** + **絵文字**で表示
- 色は効果タイプによって変化：
  - 🍎 赤系: HP回復
  - 🍇 青系: Energy回復
  - 🍌 黄系: 気分改善
  - 🍊 紫系: 複合効果

## カスタマイズ

### コンテクストデータの編集

`pokemon_context.json`を編集することで、ポケモンの情報やシナリオをカスタマイズできます：

```json
{
  "pikachu": {
    "name": "ピカチュウ",
    "personality": "勇敢で忠実、仲間思い",
    ...
  },
  "interaction_scenarios": [
    "偶然の出会い：3匹が森で出会う",
    ...
  ]
}
```

### イベント確率の調整

`simulation_engine.py`の`SimulationEngine`クラスで確率を変更できます：

```python
self.battle_probability = 0.15      # バトル確率
self.friendship_probability = 0.2   # 友情イベント確率
self.learn_probability = 0.1        # 学習確率
self.random_event_probability = 0.1 # ランダムイベント確率
```

### ビジュアライゼーションのカスタマイズ

`visualization.py`で以下をカスタマイズできます：

- グリッドサイズ
- 色のマッピング
- 更新間隔
- 表示レイアウト

## ステータス表示の詳細

標準ビジュアライザー（`--visualizer standard`）では、画面右上に各ポケモンの詳細なステータスが**カード形式**で表示されます：

### ステータスカードのレイアウト

各ポケモンは個別の**色付きカード**で表示されます：

```
┌─────────────────────────────────────┐
│ [ピカチュウ]              😊 happy  │  ← 名前（色付き）+ 気分
│                                     │
│  ⭕ HP    ⭕ EN    ⚡技 (5)        │  ← 円形プログレス + 技リスト
│   85      60       • でんき        │
│                    • 10まん        │
│                                     │
│  🎒 2/3  🍎 🍇            ピ━ ニ━│  ← 持ち物 + 関係性バー
└─────────────────────────────────────┘
```

### 表示要素

1. **Step数**: 左上に青い背景で表示
2. **カード背景**: 各ポケモンの色（黄・灰・緑）で淡く表示
3. **ポケモン名**: 左上に色付き背景のラベル
4. **円形プログレスバー**: 
   - **HP円**: 赤（低）→ 黄→ 緑（高）のグラデーション
   - **EN円**: オレンジ（低）→ 青（高）のグラデーション
   - 中央に数値表示
   - ドーナツ型で視覚的
5. **気分**: 右上に大きな絵文字で表示
   - 😐 normal（通常）
   - 😊 happy（幸せ）
   - 😠 angry（怒り）
   - 😴 tired（疲れ）
   - ✨ excited（興奮）
6. **技リスト**: 右側に箇条書きで表示（最大4個）
7. **持ち物**: 右下に絵文字アイコンで表示
   - 金色の枠付き
   - 最大3個まで表示
8. **関係性バー**: カード下部にミニバーで表示
   - 緑バー: 良好（30以上）
   - 黄バー: 中立（-30〜30）
   - 赤バー: 敵対（-30以下）
   - 相手の名前（1文字）を表示

### 円形プログレスバーの色

- **HP円**: HP値に応じて色が変化
  - 0-30: 赤（危険）
  - 30-70: 赤→緑のグラデーション
  - 70-100: 緑（健康）

- **Energy円**: Energy値に応じて色が変化
  - 0-30: オレンジ（疲労）
  - 30-70: オレンジ→青のグラデーション
  - 70-100: 青（元気）

### ビジュアルの特徴

- **カード形式**: 各ポケモンが独立したカードとして表示
- **色分け**: ポケモンの色でカード背景と枠を色分け
- **円形プログレス**: ドーナツ型のプログレスバーで直感的
- **アイコン表示**: 技や持ち物を視覚的に表示
- **関係性グラフ**: ミニバーで関係性を可視化

## トラブルシューティング

### OpenAI APIエラー

```
⚠️  警告: OPENAI_API_KEYが設定されていません
```

**解決策**: `.env`ファイルを作成してAPIキーを設定するか、`--no-openai`フラグを使用

### ChromaDBエラー

```
⚠️  RAGシステムの初期化に失敗
```

**解決策**: ChromaDBの再インストール
```bash
pip uninstall chromadb
pip install chromadb
```

### Matplotlibの日本語表示エラー

**解決策**: `japanize-matplotlib`を使用しているため、通常は問題ありません

もし日本語が表示されない場合：
```bash
pip install --upgrade japanize-matplotlib
```

macOS/Linux:
```bash
# システムフォントが自動的に使用されます
```

Windows:
```bash
# 日本語フォントをインストール
pip install japanize-matplotlib
```

## 論文について

このプロジェクトは以下の論文に基づいています：

**Towards Digital Nature: Bridging the Gap between Turing Machine Objects and Linguistic Objects in LLMMs for Universal Interaction of Object-Oriented Descriptions**

- Authors: Yoichi Ochiai, Naruya Kondo, Tatsuki Fushimi
- arXiv:2304.04498v2 [cs.HC] 12 Apr 2023

ALOsシステムは、言語オブジェクト（LOs）とチューリングマシンオブジェクト（TMOs）を橋渡しする抽象化レイヤーとして機能し、LLMを使用してシームレスなオブジェクト指向記述を可能にします。

## ライセンス

このプロジェクトは教育目的で作成されています。

## 謝辞

- 論文の著者である落合陽一先生、近藤那由太氏、伏見卓紀氏に感謝します
- ポケモンは任天堂/クリーチャーズ/ゲームフリークの商標です

## 今後の拡張案

- [ ] より多くのポケモンの追加
- [ ] 進化システムの実装
- [ ] 3Dビジュアライゼーション（Three.js）
- [ ] マルチエージェント学習
- [ ] バトルシステムの詳細化
- [ ] セーブ/ロード機能
- [ ] ネットワークマルチプレイヤー

---

**楽しいシミュレーションを！** 🎮✨

